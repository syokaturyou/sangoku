<% breadcrumb :sightshow  %>
<%= breadcrumbs separator: " > " , class: :logo %>
<h1>おすすめ地域詳細</h1>
<div class="container">
  <div class="row">
    <div class="col-8">
      <% results=Geocoder.search(@sight.address) %>
      <% if results.present? %>
        <% @latlng=results.first.coordinates %>
        <%= image_tag "https://maps.googleapis.com/maps/api/streetview?size=640x420&heading=180&fov=120&location=#{@latlng[0]},#{@latlng[1]}&sensor=true&key=#{ENV['GOOGLE_API_KEY']}", fallback: "no_image.jpg", size: '640x420' %>
      <% end %>
      </br>
      説明:
      <%= simple_format(@sight.profile) %>
    </div>
    <div class="col-4">
      <table>
        <tbody>
          <tr>
            <td>住所:</td>
            <td><%= @sight.address %></td>
            </tr>
          <tr>
            <td>(緯度, 経度):</td>
            <td>(<%= @sight.latitude %>, <%= @sight.longitude %>)</td>
          </tr>
          <tr>
            <td>投稿者:</td>
            <td><%= link_to attachment_image_tag( @sight.member, :profileimage, fallback: "no_image.jpg", size: '80x80'), public_member_path(@sight.member), data: {"turbolinks"=>false} %><%= @sight.member.name %></td>
          </tr>
          <tr>
            <td>更新日時:</td>
            <td><%= @sight.updated_at.to_s(:datetime_jp) %></td>
          </tr>
          <tr>
            <td>いいね数:</td>
            <td><%= @sight.likes.count %>
                <% if member_signed_in? %>
                  <% if @sight.liked?(current_member) %>
                    <%= link_to sight_likes_path(@sight.id), method: :delete, data: {remote: true} do %>
                      <span style="color:red;">❤︎</span>
                    <% end %>
                  <% else %>
                    <%= link_to sight_likes_path(@sight.id), method: :post, data: {remote: true} do %>
                      <span>❤︎</span>
                    <% end %>
                  <% end %>
                <% else %>
                  <span>❤︎</span>
                % end %>
            </td>
          </tr>
          <tr>
            <td>評価:</td>
            <td><%= render 'evaluates/review', sight: @sight %></td>
          </tr>
          <tr>
            <td></td>
            <td>
              <% if member_signed_in? %>
                <% if @sight.member.id == current_member.id %>
                  <%= link_to "編集する", edit_sight_path(@sight), class: 'btn btn-success', data: {"turbolinks"=>false} %>
                  <%= link_to "削除する", sight_path(@sight), class: 'btn btn-danger', method: :delete, data: { confirm: "本当に削除しますか？" }%>
                <% elsif @sight.member.id != current_member.id %>
                  <%= link_to '評価する', new_sight_evaluate_path(@sight.id), class: 'btn btn-warning', data: {"turbolinks"=>false} %>
                <% end %>
              <% elsif admin_signed_in? %>
                <%= link_to "削除する", sight_path(@sight), class: 'btn btn-danger', method: :delete, data: { confirm: "本当に削除しますか？" }%>
              <% else %>
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
